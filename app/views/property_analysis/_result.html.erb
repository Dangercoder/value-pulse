<div class="mb-6">
  <h2 class="text-2xl font-semibold text-gray-900 mb-2">Property Valuation Report</h2>
  <p class="text-gray-600">AI-powered analysis of your property's market value.</p>
</div>

<!-- Property Information Header Card -->
<div class="bg-white rounded-lg border border-gray-200 p-6 mb-6">
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
    <div class="mb-4 md:mb-0">
      <h3 class="text-lg font-semibold text-gray-900"><%= analysis[:address] %></h3>
      <% 
        # Extract property type from analysis content if available
        property_type = if analysis[:content] =~ /Property Type:\s*([^<\n]+)/
          $1.strip
        else
          "Residential Property"
        end
        
        # Extract price range from analysis content
        price_range = if analysis[:content] =~ /Estimated Value Range:?\s*([^<\n]+)/i
          $1.strip
        else
          "Price information unavailable"
        end
      %>
      <p class="text-gray-600"><%= property_type %></p>
      <p class="text-xl font-bold text-indigo-700 mt-1"><%= price_range %></p>
    </div>

    <% 
      # Extract confidence level from analysis content
      confidence_level = if analysis[:content] =~ /confidence level:?\s*(Low|Medium|High)/i
        $1.downcase
      else
        "unknown"
      end
      
      confidence_colors = {
        "low" => "bg-red-100 text-red-800 border-red-300",
        "medium" => "bg-yellow-100 text-yellow-800 border-yellow-300",
        "high" => "bg-green-100 text-green-800 border-green-300",
        "unknown" => "bg-gray-100 text-gray-800 border-gray-300"
      }
      
      confidence_color = confidence_colors[confidence_level]
    %>
    
    <div class="flex items-center">
      <div class="<%= confidence_color %> rounded-lg py-2 px-4 border font-semibold">
        <%= confidence_level.upcase %> CONFIDENCE
      </div>
    </div>
  </div>
</div>

<!-- Main Analysis Content -->
<div class="bg-white rounded-lg border border-gray-200 p-6 mb-6">
  <div class="prose prose-sm max-w-none">
    <%= raw analysis[:content].gsub(
      # Remove the confidence level section since we're showing it as a badge
      /Confidence Level.*?(Low|Medium|High).*?(?=Key Factors|$)/mi, 
      ""
    ).gsub(
      # Remove the price range since we're showing it at the top
      /Estimated Value Range:?.*?(?=Key Factors|Confidence Level|$)/mi,
      ""
    ).gsub(
      # Make property info section smaller since we show it at the top
      /(Property Valuation:.*?)(?=Estimated Value Range|Key Factors|$)/mi,
      "<div class='text-sm text-gray-500'>\\1</div>"
    ) %>
  </div>
  
  <div class="mt-6 pt-6 border-t border-gray-200">
    <div class="flex items-center justify-between text-sm">
      <p class="text-gray-500">
        Generated by <%= analysis[:model_used] %> on <%= analysis[:timestamp] %>
      </p>
    </div>
  </div>
</div>

<div class="flex justify-end">
  <%= link_to "Analyze Another Property", root_path, class: "rounded-lg bg-indigo-600 px-6 py-3 text-base font-medium text-white hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2" %>
</div> 